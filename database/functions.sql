SELECT users.id, users.name, users.profileImgUrl, tbl1.message FROM (SELECT ROW_NUMBER() OVER (PARTITION BY IF(senderId = 1, receiverId, senderId) ORDER BY sendAt DESC) as rowNum, messages.*, IF(senderId = 1, receiverId, senderId) AS userId FROM messages WHERE  senderId = 1 OR receiverId = 1) AS tbl1 INNER JOIN users ON users.id = tbl1.userId WHERE tbl1.rowNum = 1 ORDER BY sendAt DESC